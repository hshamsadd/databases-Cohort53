# Databases Week 2: Easy Guide to Data Management (Updated)

Hello! This week, we're going to learn some super important ideas about how databases work. Don't worry if you're new to this ‚Äì I'll explain everything in a very simple way, like we're just chatting. We'll use lots of easy examples you can try yourself, both in a tool called pgAdmin 4 (for database commands) and with Node.js (for writing code that talks to the database), using the specific connection method you provided.

## 0. Talking to Databases: It's Like Sending a Letter (Asynchronous)

Imagine you send a letter to a friend. You don't just stand by the mailbox waiting for their reply, right? You go do other things, and check for the reply later. Talking to a database works a bit like that. It's called "asynchronous" communication.

### What does "Asynchronous" mean?

When your computer program (like a Node.js app) asks the database to do something (like find some information or save new data), it doesn't just stop and wait. It sends the request and then immediately goes on to do other tasks. This is good because your program doesn't get stuck.

But sometimes, you need things to happen in a certain order. For example, you can't put new data into a table *before* you create the table itself. In these cases, your program needs to wait for the database to finish one task before starting the next.

In Node.js (and JavaScript), we use special words like `async` and `await` to help us manage this waiting game. They make sure things happen in the right order without making your whole program freeze.

*   `async`: You put this word before a function to tell JavaScript, "Hey, this function might take some time to finish, and it will give me a 'promise' that it will eventually complete."
*   `await`: You put this word before a task that returns a promise. It tells JavaScript, "Wait here until this task is completely done before moving on."

### Simple Example (Node.js)

Let's say you want to:
1.  Create a new table in your database.
2.  Then, put some data into that new table.

If you try to put data in before the table is ready, you'll get an error! `async` and `await` help us avoid this.

Here's a very simple Node.js example using the connection method you provided. Imagine `createTableInDatabase()` and `insertDataIntoDatabase()` are functions that talk to your database. They are `async` because talking to a database takes time.

```javascript
import { setupDatabase } from './connectDatabase.js';

async function createTableInDatabase(client) {
  console.log("Step 1: Starting to create the table...");
  await client.query(`
    CREATE TABLE IF NOT EXISTS my_test_table (
      id SERIAL PRIMARY KEY,
      message TEXT
    );
  `);
  console.log("Step 1: Table is now created!");
}

async function insertDataIntoDatabase(client) {
  console.log("Step 2: Starting to insert data...");
  await client.query(`
    INSERT INTO my_test_table (message) VALUES ('Hello from Node.js!');
  `);
  console.log("Step 2: Data is now inserted!");
}

export async function runMyDatabaseTasks() {
  let client; // declare here for finally
  try {
    client = await setupDatabase(true); // drops and creates a fresh DB
    console.log("Starting all database tasks...");

    await createTableInDatabase(client);
    await insertDataIntoDatabase(client);

    console.log("‚úÖ All database tasks finished!");
  } catch (error) {
    console.error('‚ùå An error occurred:', error);
  } finally {
    if (client) {
      await client.end();
      console.log('üîí Disconnected from "demo_db".');
    }
  }
}

// Run immediately if this is the entry file
runMyDatabaseTasks();
```

**How to run this Node.js example:**
1. Make sure you're in study-guide folder.
2. Open the terminal and install dependencies:
   ```bash
   npm install
3. Open your terminal or command prompt and run: 
   ```bash
   node `demo.js`
4.  Go to pgAdmin 4 and refresh Databases you shall find there the `demo` database with the my_test_table table created inside (schemas/tables) with value of `Hello from Node.js!`.

You will also see the messages appear in the correct order in the terminal, showing how `await` makes sure one step finishes before the next one starts.

### Exercise

1.  **Try it yourself:** In the `demo.js` file, what would happen if you swapped the order of `createTableInDatabase(client)` and `insertDataIntoDatabase(client)`? Try it and see what error you get.

### The Main Idea (Essence)

Talking to databases often involves waiting, but your program doesn't have to stop completely. `async` and `await` are like traffic cops for your code, making sure database tasks happen in the right order, especially when one task depends on another. This keeps your program running smoothly and efficiently.